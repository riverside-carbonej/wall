<div class="location-picker">
  <!-- Address Search Section -->
  @if (showAddressSearch) {
    <div class="search-section">
    <mat-form-field appearance="outline" class="full-width">
      <mat-label>Search for location</mat-label>
      <input 
        matInput 
        [formControl]="addressControl"
        placeholder="Enter address, city, or landmark"
        autocomplete="off">
      <mat-icon matSuffix>search</mat-icon>
      @if (isSearching) {
        <mat-progress-bar 
          mode="indeterminate" 
          class="search-progress">
        </mat-progress-bar>
      }
    </mat-form-field>
    
    <!-- Search Results -->
    @if (searchResults.length > 0) {
      <div class="search-results">
      @for (result of searchResults; track result) {
        <div 
          class="search-result" 
          (click)="selectSearchResult(result)">
          <mat-icon class="result-icon">place</mat-icon>
          <div class="result-content">
            <div class="result-name">{{ result.displayName }}</div>
            <div class="result-coords">
              {{ result.coordinates.lat.toFixed(4) }}, {{ result.coordinates.lng.toFixed(4) }}
            </div>
          </div>
        </div>
      }
      </div>
    }
    </div>
  }
  
  <!-- Action Buttons -->
  <div class="action-buttons">
    @if (showCurrentLocationButton) {
      <button 
        mat-raised-button 
        color="primary"
        (click)="getCurrentLocation()"
        [disabled]="isGettingLocation">
        <mat-icon>my_location</mat-icon>
        @if (!isGettingLocation) {
          <span>Use Current Location</span>
        }
        @if (isGettingLocation) {
          <span>Getting Location...</span>
        }
      </button>
    }
    
    @if (hasLocation) {
      <button 
        mat-outlined-button
        (click)="clearLocation()">
        <mat-icon>clear</mat-icon>
        Clear Location
      </button>
    }
  </div>
  
  <!-- Map Container -->
  <div class="map-container">
    <div 
      #mapContainer 
      id="location-picker-map"
      [style.height]="height"
      class="map">
    </div>
    
    <!-- Map Instructions Overlay -->
    @if (allowMapClick && !hasLocation) {
      <div class="map-instructions">
      <mat-icon>touch_app</mat-icon>
      <span>Click on the map to select a location</span>
      </div>
    }
  </div>
  
  <!-- Coordinate Inputs -->
  @if (showCoordinateInputs) {
    <div class="coordinate-inputs">
    <div class="coordinate-row">
      <mat-form-field appearance="outline" class="coordinate-field">
        <mat-label>Latitude</mat-label>
        <input 
          matInput 
          type="number"
          step="any"
          [formControl]="latitudeControl"
          placeholder="e.g., 40.7128">
        @if (latitudeControl.hasError('min')) {
          <mat-error>
            Latitude must be between -90 and 90
          </mat-error>
        }
        @if (latitudeControl.hasError('max')) {
          <mat-error>
            Latitude must be between -90 and 90
          </mat-error>
        }
      </mat-form-field>
      
      <mat-form-field appearance="outline" class="coordinate-field">
        <mat-label>Longitude</mat-label>
        <input 
          matInput 
          type="number"
          step="any"
          [formControl]="longitudeControl"
          placeholder="e.g., -74.0060">
        @if (longitudeControl.hasError('min')) {
          <mat-error>
            Longitude must be between -180 and 180
          </mat-error>
        }
        @if (longitudeControl.hasError('max')) {
          <mat-error>
            Longitude must be between -180 and 180
          </mat-error>
        }
      </mat-form-field>
    </div>
    
    <!-- Selected Location Display -->
    @if (hasLocation) {
      <div class="selected-location">
      <mat-icon class="location-icon">place</mat-icon>
      <div class="location-details">
        <div class="location-coordinates">
          {{ currentCoordinates!.lat.toFixed(6) }}, {{ currentCoordinates!.lng.toFixed(6) }}
        </div>
        @if (currentCoordinates && currentCoordinates.address) {
          <div class="location-address">
            {{ currentCoordinates.address }}
          </div>
        }
      </div>
      </div>
    }
    </div>
  }
</div>