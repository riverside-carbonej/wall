<div class="location-picker-material">
  <!-- Compact selected location display -->
  @if (hasLocation) {
    <div class="selected-location-chip">
      <mat-icon class="location-icon">place</mat-icon>
      <div class="location-text">
        @if (currentCoordinates && currentCoordinates.address) {
          <span class="address-text">{{ currentCoordinates.address }}</span>
        } @else if (currentCoordinates) {
          <span class="coords-text">{{ currentCoordinates.lat.toFixed(4) }}, {{ currentCoordinates.lng.toFixed(4) }}</span>
        }
      </div>
      <button mat-icon-button class="clear-btn" (click)="clearLocation()">
        <mat-icon>close</mat-icon>
      </button>
    </div>
  }

  <!-- Map Container - Always visible -->
  <div class="integrated-map-container" [class.has-location]="hasLocation">
    <div 
      #mapContainer 
      [style.height]="height"
      class="map-view">
    </div>
    
    <!-- Overlay instruction when no location -->
    @if (!hasLocation) {
      <div class="map-overlay-instruction">
        <mat-icon>touch_app</mat-icon>
        <span>Click map to select location</span>
      </div>
    }
  </div>

  <!-- Compact controls row -->
  <div class="location-controls">
    <!-- Search input -->
    @if (showAddressSearch) {
      <div class="search-input-wrapper">
        <input 
          class="material-search-input"
          [formControl]="addressControl"
          placeholder="Search address or place..."
          autocomplete="off">
        <mat-icon class="search-icon">search</mat-icon>
        
        <!-- Search Results Dropdown -->
        @if (searchResults.length > 0) {
          <div class="search-dropdown">
            @for (result of searchResults; track result) {
              <div class="search-item" (click)="selectSearchResult(result)">
                <mat-icon>place</mat-icon>
                <span class="search-text">{{ result.displayName }}</span>
              </div>
            }
          </div>
        }
      </div>
    }
    
    <!-- Current location button -->
    @if (showCurrentLocationButton) {
      <button 
        mat-icon-button
        class="location-btn"
        (click)="getCurrentLocation()"
        [disabled]="isGettingLocation"
        title="Use current location">
        <mat-icon>my_location</mat-icon>
      </button>
    }
  </div>

  <!-- Optional coordinate inputs - more compact -->
  @if (showCoordinateInputs && hasLocation && currentCoordinates) {
    <div class="coordinate-display">
      <span class="coord-label">Coordinates:</span>
      <span class="coord-value">{{ currentCoordinates.lat.toFixed(6) }}, {{ currentCoordinates.lng.toFixed(6) }}</span>
    </div>
  }
</div>